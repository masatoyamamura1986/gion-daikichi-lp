---
import type { Lang, MenuItem as MenuItemType } from "../lib/microcms";
import { localized, isSafeUrl } from "../lib/microcms";
import MenuItemComponent from "./MenuItem.astro";

interface Props {
  lang: Lang;
  recommended: MenuItemType[];
  collaboration: MenuItemType[];
  otherMenuUrl?: string;
}

const { lang, recommended, collaboration, otherMenuUrl } = Astro.props;
---

<section class="menu" id="menu">
  <div class="section-heading">
    <h2>{lang === "ja" ? "お品書き" : "Menu"}</h2>
  </div>

  <!-- おすすめ料理 -->
  <h3 class="menu-sub-heading">
    {lang === "ja" ? "おすすめ料理" : "Top 3 Recommended Dishes"}
  </h3>
  <div class="menu-recommended">
    {recommended.map((item) => (
      <MenuItemComponent
        lang={lang}
        image={item.image}
        name={localized(item, "name", lang)}
        price={item.price}
        description={localized(item, "description", lang)}
        movieUrl={item.movieUrl}
        movieLabel={lang === "ja" ? "動画" : "Movie"}
      />
    ))}
  </div>

  <!-- コラボメニュー -->
  <h3 class="menu-sub-heading">
    {lang === "ja" ? "味味香コラボメニュー" : "Mimiko Collaboration Menu"}
  </h3>
  <div class="menu-collab">
    {collaboration.map((item) => {
      const collabLabel = localized(item, "collabLabel", lang);
      const collabUrl = item.collaborationUrl;
      return (
        <MenuItemComponent
          lang={lang}
          image={item.image}
          name={localized(item, "name", lang)}
          price={item.price}
          description={localized(item, "description", lang)}
          movieUrl={collabUrl}
          movieLabel={collabLabel || (lang === "ja" ? "動画" : "Movie")}
        />
      );
    })}
  </div>

  <!-- その他のメニュー -->
  {otherMenuUrl && isSafeUrl(otherMenuUrl) && (
    <div class="menu-bottom">
      <a
        href={otherMenuUrl}
        class="btn-outline"
        target="_blank"
        rel="noopener"
      >
        {lang === "ja" ? "その他のメニュー" : "Other Menu Items"}
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 8h10M9 4l4 4-4 4" stroke="#585858" stroke-width="1" />
        </svg>
      </a>
    </div>
  )}
</section>

<style>
  .menu {
    padding: 120px 0;
    border-bottom: 1px solid #e8e8e8;
    max-width: var(--max-width);
    margin: 0 auto;
  }

  .menu-sub-heading {
    font-size: 20px;
    font-weight: 500;
    letter-spacing: 0.12em;
    line-height: 1.6;
    color: #585858;
    text-align: center;
    margin-bottom: 50px;
  }

  .menu-recommended {
    display: flex;
    flex-direction: column;
    gap: 60px;
    margin-bottom: 100px;
  }

  .menu-collab {
    display: flex;
    flex-direction: column;
    gap: 60px;
    margin-bottom: 80px;
  }

  .menu-bottom {
    display: flex;
    justify-content: center;
  }

  /* SP */
  @media (max-width: 768px) {
    .menu {
      padding: 60px var(--sp-padding);
    }

    .menu-sub-heading {
      font-size: 18px;
      margin-bottom: 30px;
    }

    .menu-recommended {
      gap: 50px;
      margin-bottom: 60px;
    }

    .menu-collab {
      gap: 50px;
      margin-bottom: 50px;
    }
  }
</style>
